$(function(){initPages();bindEvent()});function initPages(){initDateSelect();var B=$(window).height()-120;var A=false;if($(window).width()<=768){A=true}$("#userlist").bootstrapTable({cardView:A,undefinedText:"",cache:false,height:B,striped:true,pagination:true,pageSize:50,pageList:[10,25,50,100,200],sidePagination:"server",onPageChange:function(D,C){var E=$("#userlist").bootstrapTable("getOptions");var F=E.sortName;var G=E.sortOrder;getData(D,C,F,G)},onSort:function(E,F){var D=$("#userlist").bootstrapTable("getOptions");var G=D.pageNumber;var C=D.pageSize;getData(G,C,E,F)}});getData(1,50)}function getData(G,E,A,F,H){var D=dateRange.getCurrentDate().startDate;var B=dateRange.getCurrentDate().endDate;var C={"startDate":D,"endDate":B,"pageNumber":G,"pageSize":E,"sortName":A,"order":F,"keyValue":H};$("#userlist").bootstrapTable("showLoading");$.ajax({url:"getAllContactsData.do",data:{"queryParam":JSON.stringify(C)},method:"post",async:true,success:function(J){if(J.statusCode==504){$.messager.popup("系统错误，错误代码504。")}else{var I={total:J.content.totalRecord,rows:J.content.contacts};$("#userlist").bootstrapTable("hideLoading");$("#userlist").bootstrapTable("load",I);addActiveClass();$("table#userlist tbody tr").mouseover(function(){$(this).addClass("in_right")});$("table#userlist tbody tr").mouseout(function(){$(this).removeClass("in_right")})}}})}function bindEvent(){$("#confirm").click(function(A){query()});window.contactsEvents={"click .edit":function(A,D,C,B){$("#createContactLabel").text("修改联系人信息");$("#updateContacts").show();$("#insertContacts").hide();createContact(C,1)},"click .remove":function(A,D,C,B){delcontact(C)}};window.viewCustomerInfo={"click .customerName":function(A,D,C,B){window.location.href="customerInfo.jsp?menuID=2&customerID="+C.customerID}};$("#updateContacts").click(function(){updateContacts()});$("#insertContacts").click(function(){addContacts()});$("#serachContact").off("keyup drop").on("keyup drop",function(B){if(B.keyCode=="13"){var A=$("#serachContact").val();keySearch(A)}});$("#createUser").click(function(){createUser()});$("#createContactModal").on("hidden.bs.modal",function(){$("#inputCustomer").attr("readonly","readonly")})}function query(){getData(1,50)}function keySearch(B){var A=$("#userlist").bootstrapTable("getOptions");var C=A.sortName;var D=A.sortOrder;getData(1,50,C,D,B)}function createUser(){$("#inputCustomer").removeAttr("readonly");$("#insertContacts").show();$("#updateContacts").hide();initSelectbox($("#roleSelect"),"10001013",0,0);$("#createContactModal").modal({backdrop:"static",keyboard:false})}function addContacts(){var A={"customerName":$("#inputCustomer").val(),"name":$("#inputContactName").val(),"role":$("#roleSelect").val(),"roleName":$("#roleSelect").find("option:selected").text(),"office":$("#inputoffice").val(),"mobileNumber":$("#inputmobileNumber").val(),"landlineNumber":$("#inputlandlineNumber").val(),"qq":$("#inputContactQQ").val(),"weixin":$("#inputweixin").val(),"email":$("#inputContactEmail").val(),"companyAddr":$("#companyAddr").val().replace(new RegExp("\n","gm"),"<br>")};$.ajax({url:"addContacts.do",data:{"contacts":JSON.stringify(A)},method:"post",async:true,success:function(B){if(B.statusCode==504){$.messager.popup("系统错误，错误代码504。")}else{if(B.statusCode==4){window.open("login.jsp")}else{$.messager.popup("添加成功");$("#createContactModal").modal("hide");refreshTable($("#userlist"))}}}})};