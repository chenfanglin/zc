$(function(){initPages();bindEvent()});function initPages(){initDateMonthSelect();initDateDynamicSelect();initTodayBtn($("#jzDate"));initKpiFilter();var C=$(window).height()-120;var A=false;if($(window).width()<=768){A=true}$("#businessKPI").bootstrapTable({cardView:A,undefinedText:"",cache:false,height:C,striped:true,pagination:true,pageSize:50,pageList:[10,25,50,100,200],sidePagination:"server",onPageChange:function(E,D){var F=$("#businessKPI").bootstrapTable("getOptions");var G=F.sortName;var H=F.sortOrder;getData(E,D,G,H)},onSort:function(F,G){var E=$("#businessKPI").bootstrapTable("getOptions");var H=E.pageNumber;var D=E.pageSize;getData(H,D,F,G)}});var B=$("#roleinput").val();if(B=="00000003"){$("#businessKPI").bootstrapTable("hideColumn","newEquipNum")}else{$("#businessKPI").bootstrapTable("showColumn","newEquipNum")}getData(1,50)}function getData(C,A,B,D){var E=buildCondition(C,A,B,D);$("#businessKPI").bootstrapTable("showLoading");$.ajax({url:"getbusinessKPIDatas.do",data:{"queryParam":JSON.stringify(E)},method:"post",async:true,success:function(G){if(G.statusCode==504){$.messager.popup("系统错误，错误代码504")}else{var F={total:G.content.totalRecord,rows:G.content.businessKPI};$("#businessKPI").bootstrapTable("hideLoading");$("#businessKPI").bootstrapTable("load",F);$(".channelSwitch").bootstrapSwitch("size","small");addActiveClass()}}})}function initKpiFilter(){$.ajax({url:"getKpiSelect.do",method:"post",async:false,success:function(D){var C=D.content.businesser;var A=D.content.platformType;var B=setOption(C);$("#businesserfilter").html(B.join(""));B=setOption(A);$("#platformTypefilter").html(B.join(""))}})}function bindEvent(){$("#confirm").click(function(){query();cancel()});$("input[name=radioName]").click(function(){query()});$("#exportExcel").click(function(){exportExcel()});window.viewCustomerInfo={"click .customerName":function(A,D,C,B){window.location.href="customerInfo.jsp?menuID=2&customerID="+C.customerID}}}function changeRewardStatus(B,C,A){$.ajax({url:"saveRewardStatus.do",data:{"customerID":B,"flag":C},method:"post",async:true,success:function(D){$.messager.popup(A)}})}function query(){var C=$("#businessKPI").bootstrapTable("getOptions");var D=C.sortName;var E=C.sortOrder;var B=C.pageNumber;var A=C.pageSize;getData(B,A,D,E)}function exportExcel(){var B=$("#businessKPI").bootstrapTable("getOptions");var C=B.sortName;var D=B.sortOrder;var A=buildCondition(1,50,C,D);window.location="exportKpi.do?queryParam="+JSON.stringify(A)}function buildCondition(J,H,B,I){var G=dateMonthRange.getCurrentDate().startDate;var D=dateMonthRange.getCurrentDate().endDate;var L=dynamicRange.getCurrentDate().startDate;var A=dynamicRange.getCurrentDate().endDate;var E=$("#jzDate").val();var C=$("#platformTypefilter").val();if(C==-1){C=""}var M=$("#businesserfilter").val();if(M==-1){M=""}var K=$('input[name="radioName"]:checked').val();var F={"startDate":G,"endDate":D,"startTime":L,"endTime":A,"jzDate":E,"platform":C,"businesser":M,"pageNumber":J,"pageSize":H,"sortName":B,"order":I,"flag":K};return F};