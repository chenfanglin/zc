$(function(){initPages();bindEvent()});function initPages(){initDateSelect();initProblemTable()}function getData(C,A,B,D){var E=buildCondition(C,A,B,D);$("#operationData").bootstrapTable("showLoading");$.ajax({url:"getOperations.do",data:{"queryParam":JSON.stringify(E)},method:"post",async:true,success:function(G){if(G.statusCode==504){$.messager.popup("系统错误，错误代码504。")}else{var F={total:G.content.totalRecord,rows:G.content.problem};$("#operationData").bootstrapTable("hideLoading");$("#operationData").bootstrapTable("load",F);addActiveClass()}}})}function getVisitData(A,F,J,G){var H=dateRange.getCurrentDate().startDate;var B=dateRange.getCurrentDate().endDate;var E=$("#operationsfilter1").val();if(E==-1){E=""}var C=$("#customerStatusfilter").val();if(C==-1){C=""}var I=$("#serachVisit").val();var D={"startDate":H,"endDate":B,"operations":E,"customerStatus":C,"pageNumber":A,"pageSize":F,"sortName":J,"order":G,"keyValue":I};$("#visitData").bootstrapTable("showLoading");$.ajax({url:"getVisitDatas.do",data:{"queryParam":JSON.stringify(D)},method:"post",async:true,success:function(L){if(L.statusCode==504){$.messager.popup("系统错误，错误代码504。")}else{var K={total:L.content.totalRecord,rows:L.content.visitData};$("#visitData").bootstrapTable("hideLoading");$("#visitData").bootstrapTable("load",K)}}})}function buildCondition(B,H,M,I){var J=dateRange.getCurrentDate().startDate;var E=dateRange.getCurrentDate().endDate;var G=$("#operationsfilter").val();if(G==-1){G=""}var D=$("#technicalersfilter").val();if(D==-1){D=""}var C=$("#problemTypefilter").val();if(C==-1){C=""}var K=$("#subdivisionTypefilter").val();if(K==-1){K=""}var A=$("#problemStatusfilter").val();if(A==-1){A=""}var L=$("#platformfilter").val();if(L==-1){L=""}var F={"startDate":J,"endDate":E,"operations":G,"technicalers":D,"problemType":C,"detailType":K,"problemStatus":A,"platform":L,"pageNumber":B,"pageSize":H,"sortName":M,"order":I};return F}function initProblemTable(){initProblemFilter();var B=$(window).height()-160;var A=false;if($(window).width()<=768){A=true}$("#operationData").bootstrapTable({cardView:A,undefinedText:"",cache:false,height:B,striped:true,pagination:true,pageSize:50,pageList:[10,25,50,100,200],sidePagination:"server",onPageChange:function(D,C){var E=$("#operationData").bootstrapTable("getOptions");var F=E.sortName;var G=E.sortOrder;getData(D,C,F,G)},onSort:function(E,F){var D=$("#operationData").bootstrapTable("getOptions");var G=D.pageNumber;var C=D.pageSize;getData(G,C,E,F)},rowStyle:function(C,D){if(C.problemStatus=="00000001"){return{classes:"waring_info"}}else{if(C.problemStatus=="00000004"){return{classes:"info_info"}}else{return{}}}}});initprivilege($("#operationData"));getData(1,50)}function initVisitTable(){initVisitFilter();var B=$(window).height()-160;var A=false;if($(window).width()<=768){A=true}$("#visitData").bootstrapTable({cardView:A,undefinedText:"",cache:false,height:B,striped:true,pagination:true,pageSize:50,pageList:[10,25,50,100,200],sidePagination:"server",onPageChange:function(D,C){var E=$("#visitData").bootstrapTable("getOptions");var F=E.sortName;var G=E.sortOrder;getVisitData(D,C,F,G)},onSort:function(E,F){var D=$("#visitData").bootstrapTable("getOptions");var G=D.pageNumber;var C=D.pageSize;getVisitData(G,C,E,F)}});initprivilege($("#visitData"));getVisitData(1,50)}function bindEvent(){window.problemEvents={"click .edit":function(A,D,C,B){openEditProblem(C)}};window.visitEvents={"click .edit":function(A,D,C,B){openEditVisit(C)}};window.viewCustomerInfo={"click .customerName":function(A,D,C,B){window.location.href="customerInfo.jsp?menuID=2&customerID="+C.customerID}};$("#makeReport").click(function(){openReport()});$("#problemTypefilter").change(function(){var A=$(this).children("option:selected").val();initSelectbox($("#subdivisionTypefilter"),A,2,true)});$("#saveProblemInfo").click(function(){updateProblemInfo()});$("#saveVisitInfo").click(function(){updateVisitInfo()});$('a[data-toggle="tab"]').on("shown.bs.tab",function(A){toggleTab(A)});$("#confirm").click(function(){getData(1,50);$("#cpProblem").toggle();hidefilter()});$("#confirmVisit").click(function(){getVisitData(1,50);$("#visitfilter").toggle();hidefilter()});$("#platformTypeSelect").change(function(){var A=$(this).children("option:selected").val();queryReportByPlatform(A)});$("#visitcancel").click(function(){$("#visitfilter").toggle();hidefilter()});$("#problemcancel").click(function(){$("#cpProblem").toggle();hidefilter()});$("#filterBtn").click(function(){filterBtn()});$("#exportExcel").click(function(){exportExcel()});$("#serachVisit").off("keyup drop").on("keyup drop",function(A){if(A.keyCode=="13"){keySearch()}})}function openEditProblem(A){$("#editProblem").modal({backdrop:"static",keyboard:false});$("#inputcustomerName").val(A.customerName);$("#inputproblemID").val(A.problemID);$("#detailProblem").val(A.detailProblem.replace(new RegExp("<br>","gm"),"\n"));$("#soloveWay").val(A.solution.replace(new RegExp("<br>","gm"),"\n"));initSelectbox($("#platformSelect"),"10001012",0);initSelectbox($("#problemTypeSelect"),"10001006",0);initSelectbox($("#detailTypeSelect"),A.problemType,2);initSelectbox($("#problemStatusSelect"),"10001007",0);$("#platformSelect").val(A.platform);$("#problemTypeSelect").val(A.problemType);$("#detailTypeSelect").val(A.typeID);$("#problemStatusSelect").val(A.problemStatus);$("#solovetime").datetimepicker({format:"yyyy-mm-dd",todayBtn:true,autoclose:true,todayHighlight:1,startView:2,minView:2});$("#solovetime").val(A.solveTime)}function updateProblemInfo(){var A={"problemID":$("#inputproblemID").val(),"platform":$("#platformSelect").val(),"platformName":$("#platformSelect").find("option:selected").text(),"problemType":$("#problemTypeSelect").val(),"problemTypeName":$("#problemTypeSelect").find("option:selected").text(),"subdivisionType":$("#detailTypeSelect").val(),"problemStatus":$("#problemStatusSelect").val(),"problemStatusName":$("#problemStatusSelect").find("option:selected").text(),"solveTime":$("#solovetime").val(),"detailProblem":$("#detailProblem").val().replace(new RegExp("\n","gm"),"<br>"),"solution":$("#soloveWay").val().replace(new RegExp("\n","gm"),"<br>")};$.ajax({url:"saveOperationData.do",data:{"problem":JSON.stringify(A)},method:"post",async:true,success:function(B){if(B.statusCode==504){$.messager.popup("系统错误，错误代码504。")}else{if(B.statusCode==4){window.open("login.jsp")}else{$.messager.popup("修改成功");$("#editProblem").modal("hide");refreshTable($("#operationData"))}}}})}function initProblemFilter(){$.ajax({url:"getProblemSelect.do",method:"post",async:false,success:function(G){var F=G.content.operations;var B=G.content.technology;var D=G.content.problemType;var A=G.content.problemStatus;var E=G.content.platformType;var C=setOption(F);$("#operationsfilter").html(C.join(""));C=setOption(B);$("#technicalersfilter").html(C.join(""));C=setOption(D);$("#problemTypefilter").html(C.join(""));C=setOption(A);$("#problemStatusfilter").html(C.join(""));C=setOption(E);$("#platformfilter").html(C.join(""))}})}function initVisitFilter(){$.ajax({url:"getVisitSelect.do",method:"post",async:false,success:function(D){var C=D.content.operations;var B=D.content.customerStatus;var A=setOption(C);$("#operationsfilter1").html(A.join(""));A=setOption(B);$("#customerStatusfilter").html(A.join(""))}})}function openReport(){initSelectbox($("#platformTypeSelect"),"10001012",0);$("#viewReport").modal({backdrop:"static",keyboard:false});$("#problemTab a:first").tab("show");showCharts("getProblemAccount.do","collectpiesChart","00000001")}function toggleTab(B){var C=$(B.target).text();if($(B.target)[0].title){C=$(B.target)[0].title}var A=$($(B.target)[0]).find("input").val();var D=$("#platformTypeSelect").val();var E=$(B.target)[0].className;if(C=="回访详情"){$("#cpProblem").hide();$("#visitfilter").show();$("#serachVisit").show();$("#exportExcel").hide();$("#makeReport").hide();$("#visitfilter").toggle();initVisitTable()}else{if(C=="CP问题反馈"){$("#cpProblem").show();$("#visitfilter").hide();$("#serachVisit").hide();$("#exportExcel").show();$("#makeReport").show();$("#cpProblem").toggle();initProblemTable()}else{if(C=="汇总"){$($(B.target)[0].hash+" a:first").tab("show");showCharts("getProblemAccount.do",A,D)}else{if(C=="咨询"){$($(B.target)[0].hash+" a:first").tab("show");showCharts("getProblemDiffTypeAccount.do",A,D,E)}else{if(C=="BUG"){$($(B.target)[0].hash+" a:first").tab("show");showCharts("getProblemDiffTypeAccount.do",A,D,E)}else{if(C=="数据"){$($(B.target)[0].hash+" a:first").tab("show");showCharts("getProblemDiffTypeAccount.do",A,D,E)}else{if(C=="接入"){$($(B.target)[0].hash+" a:first").tab("show");showCharts("getProblemDiffTypeAccount.do",A,D,E)}else{if(C=="饼图"){if(E){showCharts("getProblemDiffTypeAccount.do",A,D,E)}else{showCharts("getProblemAccount.do",A,D)}}else{if(C=="曲线图"){if(E){lineCharts("getDiffTypeChartDatas.do",A,D,E)}else{lineCharts("getChartDatas.do",A,D)}}else{if(C=="表格"){if(E){showDynamicTables($("#"+A),"getChartTabDiffTypeDatas.do",D,E)}else{showDynamicTables($("#"+A),"getChartTabDatas.do",D)}}}}}}}}}}}}function queryReportByPlatform(D){for(var B=0;B<$("#problemTab > li").length;B++){if($($("#problemTab > li")[B]).hasClass("active")){var C=$($("#problemTab > li")[B]).text();var A=$($("#problemTab > li")[B]).find("input").val();var E=$($("#problemTab > li")[B]).find("a")[0].className;if(C=="汇总"){showCharts("getProblemAccount.do",A,D)}else{if(C=="咨询"){showCharts("getProblemDiffTypeAccount.do",A,D,E)}else{if(C=="数据"){showCharts("getProblemDiffTypeAccount.do",A,D,E)}else{if(C=="接入"){showCharts("getProblemDiffTypeAccount.do",A,D,E)}else{if(C=="BUG"){showCharts("getProblemDiffTypeAccount.do",A,D,E)}}}}}}}}function filterBtn(){for(var A=0;A<$("#cpTab > li").length;A++){if($($("#cpTab > li")[A]).hasClass("active")){var B=$($("#cpTab > li")[A]).text();if(B=="CP问题反馈"){$("#cpProblem").toggle()}else{if(B=="回访详情"){$("#visitfilter").toggle()}}}}if($("#iconbtn").hasClass("up-icon")==true){showfilter()}else{hidefilter()}}function query(){for(var A=0;A<$("#cpTab > li").length;A++){if($($("#cpTab > li")[A]).hasClass("active")){var B=$($("#cpTab > li")[A]).text();if(B=="CP问题反馈"){getData(1,50)}else{if(B=="回访详情"){getVisitData(1,50)}}}}}function keySearch(){var A=$("#visitData").bootstrapTable("getOptions");var B=A.sortName;var C=A.sortOrder;getVisitData(1,50,B,C)}function exportExcel(){var B=$("#operationData").bootstrapTable("getOptions");var C=B.sortName;var D=B.sortOrder;var A=buildCondition(1,50,C,D);window.location="exportOperation.do?queryParam="+JSON.stringify(A)};