function updatePwd(){$("#updatePwdModal").modal({backdrop:"static",keyboard:false})}function updatePassword(){var C=$("#inputoldPassword").val();var B=$("#inputnewPassword").val();var A=$("#inputconfirmPassword").val();if($.trim(C).length==0){$(".check-error").show();$(".check-error").html("请输入原始密码");return}if($.trim(B).length==0){$(".check-error").show();$(".check-error").html("请输入新密码");return}if($.trim(A).length==0){$(".check-error").show();$(".check-error").html("请输入确认密码");return}if(B!=A){$(".check-error").show();$(".check-error").html("新密码和确认密码不一致");return}$(".check-error").hide();$.ajax({url:"updatePwd.do",data:{"oldpassword":C,"password":B},method:"post",async:true,success:function(D){if(D.statusCode==4){window.open("login.jsp")}else{if(D.statusCode==9){$.messager.popup("原始密码错误")}else{$.messager.popup("修改成功");$("#updatePwdModal").modal("hide")}}}})}function loginout(){$.messager.confirm("","确定退出系统？",function(){location.href="loginout.do"})}function formatterBtn(C,B,A){if(C==1){return'<button type="button" class="btn btn-primary btn-xs">审核</button>'}}function formatterThemes(C,B,A){return""+C+'<a class="edit" href="javascript:void(0)" title="题材"><i class="glyphicon glyphicon-pencil"></i></a>'}function formatterTags(C,B,A){if(C){return""+C+'<a class="edit" href="javascript:void(0)" title="标签"><i class="glyphicon glyphicon-pencil"></i></a>'}else{return'<a class="edit" href="javascript:void(0)" title="标签"><i class="glyphicon glyphicon-pencil"></i></a>'}}function formatterDealwith(C,B,A){if(C==0){return'<button type="button" class="btn btn-primary btn-xs">未处理</button>'}else{return'<button type="button" class="btn btn-primary btn-xs">已处理</button>'}}function formatterCUD(C,B,A){return['<a class="edit" href="javascript:void(0)" title="修改">','<i class="glyphicon glyphicon-edit"></i>',"</a>&nbsp;",'<a class="remove" href="javascript:void(0)" title="删除">','<i class="glyphicon glyphicon-remove"></i>',"</a>"].join("")}function formatterCustomer(C,B,A){return'<a class="customerName" href="javascript:void(0)" title="客户名称">'+C+"</a>"}function formatterEmail(C,B,A){return'<a class="email" href="javascript:void(0)" title="注册邮箱">'+C+"</a>"}function formatterDetail(C,B,A){return'<a class="detail" href="javascript:void(0)" title="详情">详情</a>'}function formatterBusiness(C,B,A){if(C){return'<a class="businessName" href="javascript:void(0)" title="'+C+'">'+C+"</a>"}}function formatterOperation(C,B,A){if(C){return'<a class="operationName" href="javascript:void(0)" title="'+C+'">'+C+"</a>"}}function formatterEdit(C,B,A){return'<a class="edit" href="javascript:void(0)" title="修改"><i class="glyphicon glyphicon-edit"></i></a>'}function formatterFocus(C,B,A){if(C>0){return'<a id="'+B.customerID+'" onclick="changeStart('+B.customerID+')" href="javascript:void(0)"><i class="glyphicon glyphicon-star btn-important-highlight"></i></a>'}else{return'<a id="'+B.customerID+'" onclick="changeStart('+B.customerID+')" href="javascript:void(0)"><i class="glyphicon glyphicon-star btn-grayed"></i></a>'}}function formatterSwitch(C,B,A){if(C==0){return'<input class="channelSwitch" type="checkbox"/>'}else{return'<input class="channelSwitch" type="checkbox" checked=true/>'}}function changeStart(A){if($("#"+A+"> i").hasClass("btn-important-highlight")){$("#"+A+"> i").removeClass("btn-important-highlight").addClass("btn-grayed");updateFocusCustomer(A,"delFocusCustomer.do","取消关注成功")}else{$("#"+A+"> i").removeClass("btn-grayed").addClass("btn-important-highlight");updateFocusCustomer(A,"addFocusCustomer.do","关注成功")}}function updateFocusCustomer(B,A,C){$.ajax({url:A,data:{"customerID":B},method:"post",async:true,success:function(D){if(D.statusCode==4){window.open("login.jsp")}else{$.messager.popup(C)}}})}function controlfilter(){$(".filterpanel").toggle();if($("#iconbtn").hasClass("up-icon")==true){showfilter()}else{hidefilter()}}function hidefilter(){$("#iconbtn").removeClass("down-icon").addClass("up-icon");$("#filterBtn").removeClass("filterbtn").addClass("filterbtnborder")}function showfilter(){$("#iconbtn").removeClass("up-icon").addClass("down-icon");$("#filterBtn").removeClass("filterbtnborder").addClass("filterbtn")}var dateRange;function initDateSelect(){var C=new Date();var A=C.getFullYear()+"-"+(C.getMonth()+1)+"-"+C.getDate();C=C.valueOf();var E=C-7*24*60*60*1000;var B=new Date(E);var D=B.getFullYear()+"-"+(B.getMonth()+1)+"-"+B.getDate();dateRange=new pickerDateRange("datevalue",{isTodayValid:true,startDate:D,endDate:A,defaultText:" 至 ",inputTrigger:"datetrigger",theme:"ta",success:function(F){query()}});return dateRange}var dateMonthRange;function initDateMonthSelect(){var C=new Date();var A=C.getFullYear()+"-"+(C.getMonth()+1)+"-"+C.getDate();C=C.valueOf();var E=C-30*24*60*60*1000;var B=new Date(E);var D=B.getFullYear()+"-"+(B.getMonth()+1)+"-"+B.getDate();dateMonthRange=new pickerDateRange("datevalue",{isTodayValid:true,startDate:D,endDate:A,defaultText:" 至 ",inputTrigger:"datemonthtrigger",theme:"ta",success:function(F){query()}});return dateMonthRange}var dynamicRange;function initDateDynamicSelect(){var C=new Date();var A=C.getFullYear()+"-"+(C.getMonth()+1)+"-"+C.getDate();C=C.valueOf();var E=C-30*24*60*60*1000;var B=new Date(E);var D=B.getFullYear()+"-"+(B.getMonth()+1)+"-"+B.getDate();dynamicRange=new pickerRange("monthdatevalue",{isTodayValid:true,startDate:D,endDate:A,defaultText:" 至 ",inputTrigger:"datetrigger",theme:"ta",success:function(F){query()}});return dynamicRange}function initTodayBtn(C){C.datetimepicker({format:"yyyy-mm-dd",todayBtn:true,autoclose:true,todayHighlight:1,startView:2,minView:2});var A=new Date();var B=A.getFullYear()+"-"+(A.getMonth()+1)+"-"+A.getDate();C.val(B)}function initMonthSelect(){var A=new Date();var B=A.getFullYear()+"-"+(A.getMonth()+1);monthPicker.create("month_picker",{trigger:"month_trigger",autoCommit:false,period:true,start_month:B,end_month:B,callback:function(){query()}})}function initSelectbox(B,A,C,D){$.ajax({url:"getEnum.do",data:{"enumTypeID":A,"flag":C},method:"post",async:false,success:function(H){var E=H.content;if(D==1){E.unshift({"text":"全部","value":"-1"})}else{if(D==0){E.unshift({"text":"无","value":"-1"})}}var F=[];for(var G=0;G<E.length;G++){F.push('<option value="'+E[G].value+'">'+E[G].text+"</option>")}B.html(F.join(""))}})}function initSelectByURL(B,A){$.ajax({url:A,method:"post",async:false,success:function(F){var C=F.content;var D=[];for(var E=0;E<C.length;E++){D.push('<option value="'+C[E].value+'">'+C[E].text+"</option>")}B.html(D.join(""))}})}function initprivilege(C){var A=location.search;var D=A.split("=")[1];var F=$("#readID"+D+"").val();var E=$("#writeID"+D+"").val();var B=$("#createID"+D+"").val();if(E==0){C.bootstrapTable("hideColumn","operate")}else{C.bootstrapTable("showColumn","operate")}}function addActiveClass(){var A=getUrlParam("menuID");$(".nav ul > li").removeClass("active");$("#"+A+"").addClass("active")}function getUrlParam(C){var B=new RegExp("(^|&)"+C+"=([^&]*)(&|$)");var A=window.location.search.substr(1).match(B);if(A!=null){return unescape(A[2])}else{return 0}}function cancel(){$(".filterpanel").toggle();hidefilter()}function setOption(A,D){var B=[];if(D){A.unshift({"text":"请选择","value":"-1"})}else{A.unshift({"text":"全部","value":"-1"})}for(var C=0;C<A.length;C++){B.push('<option value="'+A[C].value+'">'+A[C].text+"</option>")}return B}function refreshTable(B){var C=B.bootstrapTable("getOptions");var F=C.pageNumber;var A=C.pageSize;var D=C.sortName;var E=C.sortOrder;getData(F,A,D,E)}function createContact(A,B){initSelectbox($("#roleSelect"),"10001013",0);if(B==1){$("#inputcontactID").val(A.contactID);$("#inputCustomer").val(A.customerName);$("#inputContactName").val(A.name);$("#inputoffice").val(A.office);$("#inputmobileNumber").val(A.mobileNumber);$("#inputlandlineNumber").val(A.landlineNumber);$("#inputContactQQ").val(A.qq);$("#inputweixin").val(A.weixin);$("#inputContactEmail").val(A.email);$("#roleSelect").val(A.role);if(A.companyAddr){$("#companyAddr").val(A.companyAddr.replace(new RegExp("<br>","gm"),"\n"))}}else{$("#inputcustomerID").val(A.customerID);$("#roleSelect").val("");$("#inputCustomer").val(A.customerName);$("#inputContactName").val("");$("#inputoffice").val("");$("#inputmobileNumber").val("");$("#inputlandlineNumber").val("");$("#inputContactQQ").val("");$("#inputweixin").val("");$("#inputContactEmail").val("");$("#companyAddr").val("")}$("#createContactModal").modal({backdrop:"static",keyboard:false})}function insertContacts(){var A={"customerID":$("#inputcustomerID").val(),"name":$("#inputContactName").val(),"role":$("#roleSelect").val(),"roleName":$("#roleSelect").find("option:selected").text(),"office":$("#inputoffice").val(),"mobileNumber":$("#inputmobileNumber").val(),"landlineNumber":$("#inputlandlineNumber").val(),"qq":$("#inputContactQQ").val(),"weixin":$("#inputweixin").val(),"email":$("#inputContactEmail").val(),"companyAddr":$("#companyAddr").val().replace(new RegExp("\n","gm"),"<br>")};$.ajax({url:"insertContacts.do",data:{"contacts":JSON.stringify(A)},method:"post",async:true,success:function(B){if(B.statusCode==504){$.messager.popup("系统错误，错误代码504。")}else{if(B.statusCode==4){window.open("login.jsp")}else{$.messager.popup("添加成功");$("#createContactModal").modal("hide");$("#contactData").bootstrapTable("refresh")}}}})}function updateContacts(){var A={"contactID":$("#inputcontactID").val(),"name":$("#inputContactName").val(),"role":$("#roleSelect").val(),"roleName":$("#roleSelect").find("option:selected").text(),"office":$("#inputoffice").val(),"mobileNumber":$("#inputmobileNumber").val(),"landlineNumber":$("#inputlandlineNumber").val(),"qq":$("#inputContactQQ").val(),"weixin":$("#inputweixin").val(),"email":$("#inputContactEmail").val(),"companyAddr":$("#companyAddr").val()};$.ajax({url:"saveContactsData.do",data:{"contacts":JSON.stringify(A)},method:"post",async:true,success:function(B){if(B.statusCode==504){$.messager.popup("系统错误，错误代码504。")}else{if(B.statusCode==4){window.open("login.jsp")}else{$.messager.popup("修改成功");$("#createContactModal").modal("hide");if($("#contactData").length==1){$("#contactData").bootstrapTable("refresh")}else{refreshTable($("#userlist"))}}}}})}function delcontact(A){$.messager.confirm("","确定删除该条联系信息？",function(){$.ajax({url:"delContacts.do",data:{"contactID":A.contactID},method:"post",async:true,success:function(B){if(B.statusCode==504){$.messager.popup("系统错误，错误代码504。")}else{if(B.statusCode==4){window.open("login.jsp")}else{$.messager.popup("删除成功");if($("#contactData").length==1){$("#contactData").bootstrapTable("refresh")}else{refreshTable($("#userlist"))}}}}})})}function openEditVisit(A){$("#editVisit").modal({backdrop:"static",keyboard:false});initSelectbox($("#customerStatusSelect"),"10001015",0);$("#customerStatusSelect").val(A.customerStatus);$("#inputcompanyName").val(A.customerName);$("#inputvisitID").val(A.visitID);$("#inputcustomerID").val(A.customerID);$("#visitDetail").val(A.visitDetail.replace(new RegExp("<br>","gm"),"\n"))}function updateVisitInfo(){var A={"visitID":$("#inputvisitID").val(),"customerID":$("#inputcustomerID").val(),"customerStatus":$("#customerStatusSelect").val(),"customerStatusName":$("#customerStatusSelect").find("option:selected").text(),"visitDetail":$("#visitDetail").val().replace(new RegExp("\n","gm"),"<br>")};$.ajax({url:"saveVisit.do",data:{"visitData":JSON.stringify(A)},method:"post",async:true,success:function(B){if(B.statusCode==504){$.messager.popup("系统错误，错误代码504。")}else{if(B.statusCode==4){window.open("login.jsp")}else{$.messager.popup("修改成功");$("#editVisit").modal("hide");refreshTable($("#visitData"))}}}})}function formatterGame(C,B,A){return'<a class="gameName" href="javascript:void(0)" title="游戏名称">'+C+"</a>"}function showCharts(H,G,B,A){var F=new Highcharts.Chart({chart:{renderTo:G,plotBackgroundColor:null,plotBorderWidth:null,plotShadow:false,},title:{text:null},credits:{enabled:false},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}% ({point.y} 个)</b>"},plotOptions:{pie:{allowPointSelect:true,cursor:"pointer",dataLabels:{enabled:true,format:"<b>{point.name}</b>: {point.percentage:.1f} % ({point.y}个)",color:"#000000",connectorColor:"#000000"}}},series:[{type:"pie",name:"占比",data:[]}]});var E=dateRange.getCurrentDate().startDate;var C=dateRange.getCurrentDate().endDate;var D={"startDate":E,"endDate":C,"platform":B,"problemType":A};F.showLoading();$.ajax({url:H,dataType:"json",data:{"queryParam":JSON.stringify(D)},type:"post",async:true,success:function(I){if(I.statusCode==200){F.hideLoading();F.series[0].setData(I.content)}}})}function lineCharts(H,G,B,F){var C=new Highcharts.Chart({chart:{renderTo:G,plotBackgroundColor:null,plotBorderWidth:null,plotShadow:false,},title:{text:null,},credits:{enabled:false},yAxis:{title:{text:"数量"},plotLines:[{value:0,width:1,color:"#808080"}]},tooltip:{crosshairs:true,shared:true,valueSuffix:"个"},plotOptions:{line:{dataLabels:{enabled:true},enableMouseTracking:true}}});var A=[];var D=[];var E=dateRange.getCurrentDate().startDate;var I=dateRange.getCurrentDate().endDate;var J={"startDate":E,"endDate":I,"platform":B,"problemType":F};C.showLoading();$.ajax({url:H,dataType:"json",data:{"queryParam":JSON.stringify(J)},type:"post",async:true,success:function(N){if(N.statusCode==200){C.hideLoading();A=N.content.dateLists;D=N.content.graphDataModel;var K=[];for(var L=0;L<D.length;L++){var M={name:D[L].name,data:D[L].dataCount};C.addSeries(M);K.push(M)}C.xAxis[0].setCategories(A)}}})}function showChartBar(B,E){var A=new Highcharts.highcharts({chart:{renderTo:E,type:"bar"},title:{text:null},yAxis:{min:0,title:{text:"数量(个)",align:"high"},labels:{overflow:"justify"}},tooltip:{valueSuffix:"个"},plotOptions:{bar:{dataLabels:{enabled:true}}},legend:{layout:"vertical",align:"right",verticalAlign:"top",x:-40,y:100,floating:true,borderWidth:1,backgroundColor:((Highcharts.theme&&Highcharts.theme.legendBackgroundColor)||"#FFFFFF"),shadow:true},credits:{enabled:false}});var D=[];var C=[];A.showLoading();$.ajax({url:B,dataType:"json",type:"post",async:true,success:function(I){if(I.statusCode==200){A.hideLoading();D=I.content.dateLists;C=I.content.graphDataModel;var F=[];for(var G=0;G<C.length;G++){var H={data:C[G].dataCount};A.addSeries(H);F.push(H)}A.xAxis[0].setCategories(D)}}})}function showTable(D,C){D.bootstrapTable("destroy");var F=dateRange.getCurrentDate().startDate;var A=dateRange.getCurrentDate().endDate;var E={"startDate":F,"endDate":A};var B=false;if($(window).width()<=768){B=true}D.bootstrapTable({url:C,cardView:B,undefinedText:"",cache:false,striped:true,pagination:true,search:true,showColumns:true,showToggle:true,queryParams:{"queryParam":JSON.stringify(E)},responseHandler:function(G){return G.content}})}function showDynamicTables(D,C,F,G){var B=[];var E=dateRange.getCurrentDate().startDate;var A=dateRange.getCurrentDate().endDate;$.ajax({url:"getOperationColumns.do",data:{"problemType":G},type:"post",async:true,success:function(K){B.push(K.content);var I={"startDate":E,"endDate":A,"platform":F,"problemType":G};var J=$(window).height()-160;var H=false;if($(window).width()<=768){H=true}D.bootstrapTable("destroy");D.bootstrapTable({url:C,cardView:H,undefinedText:"",cache:false,striped:true,pagination:true,search:true,showColumns:true,showToggle:true,columns:B,queryParams:{"queryParam":JSON.stringify(I)},responseHandler:function(L){return L.content}})}})};