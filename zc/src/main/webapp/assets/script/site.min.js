$(function(){initPages();bindEvent()});function initPages(){initTags();addActiveClass()}function initTags(){$.ajax({url:"queryLabels.do",method:"post",async:true,success:function(B){if(B.statusCode==402){$.messager.popup("您没有权限，请先联系系统管理员")}else{if(B.statusCode==4){window.open("login.jsp")}else{var A=B.content;setTags(A)}}}})}function setTags(A){var C=[];var B=[];$.each(A,function(D,E){if(D==0){C.push('<li role="presentation" class="active"><a href="#'+E.labelID+'" data-toggle="tab" class="tab-size">'+E.labelName+"</a></li>");B.push('<div role="tabpanel" class="tab-pane active" id="'+E.labelID+'"><div id="page-wrapper"><div class="container-fluid"><div class="col-lg-12"><table id="'+E.labelTableID+'"><thead><tr><th data-field="text" data-align="center">'+E.labelName+'</th><th data-sortable="false" data-align="center" data-formatter="formatterCUD" data-events="'+E.event+'">操作</th></tr></thead></table></div></div></div></div>')}else{C.push('<li role="presentation"><a href="#'+E.labelID+'" data-toggle="tab" class="tab-size">'+E.labelName+"</a></li>");B.push('<div role="tabpanel" class="tab-pane" id="'+E.labelID+'"><div id="page-wrapper"><div class="container-fluid"><div class="col-lg-12"><table id="'+E.labelTableID+'"><thead><tr><th data-field="text" data-align="center">'+E.labelName+'</th><th data-sortable="false" data-align="center" data-formatter="formatterCUD" data-events="'+E.event+'">操作</th></tr></thead></table></div></div></div></div>')}});$("#siteTags").html(C.join(""));$("#tagsContent").html(B.join(""));initTables(A)}function initTables(A){var B=$(window).height()-120;$.each(A,function(C,D){$("#"+D.labelTableID).bootstrapTable({url:D.url,undefinedText:"",height:B,striped:true,search:true,pagination:true,showColumns:true,showToggle:true,pageSize:100,showRefresh:true,queryParams:{"enumTypeID":D.enumTypeID},responseHandler:function(E){if($("#"+D.labelID+" .fixed-table-toolbar").find("div").hasClass("columns pull-left")==false){$("#"+D.labelID+" .fixed-table-toolbar").append('<div class="columns pull-left"><button onclick="createTag('+D.enumTypeID+')" class="btn btn-success" type="button"><i class="glyphicon glyphicon-plus"></i>创建</button></div>')}return E.content}})})}function createTag(A){$("#inputenumTypeID").val(A);$("#createTagLabel").text("新建");$("#inputText").val("");$("#labelText").text(getCurrentTabs());$("#updateTag").hide();$("#insertGameType").hide();$("#insertProblemType").hide();$("#updateProblemType").hide();$("#updateGameTag").hide();$("#updateGameTheme").hide();$("#updateNewGameTags").hide();$("#updateNewGameTypes").hide();$("#insertTag").show();$("#createTagModal").modal({backdrop:"static",keyboard:false})}function bindEvent(){window.industrialEvent={"click .edit":function(A,D,C,B){openEditModal(C)},"click .remove":function(A,D,C,B){delEnumData(C)}};window.customerRankEvent={"click .edit":function(A,D,C,B){openEditModal(C)},"click .remove":function(A,D,C,B){delEnumData(C)}};window.clueEvent={"click .edit":function(A,D,C,B){openEditModal(C)},"click .remove":function(A,D,C,B){delEnumData(C)}};window.dataEvent={"click .edit":function(A,D,C,B){openEditModal(C)},"click .remove":function(A,D,C,B){delEnumData(C)}};window.roleEvent={"click .edit":function(A,D,C,B){openEditModal(C)},"click .remove":function(A,D,C,B){delEnumData(C)}};window.customerStatusEvent={"click .edit":function(A,D,C,B){openEditModal(C)},"click .remove":function(A,D,C,B){delEnumData(C)}};window.problemTypeEvent={"click .edit":function(A,D,C,B){openEditModal(C)},"click .remove":function(A,D,C,B){}};window.gameTypeEvent={"click .edit":function(A,D,C,B){openGameTypeModal(C)},"click .remove":function(A,D,C,B){}};window.gameTagEvent={"click .edit":function(A,D,C,B){openEditModal(C)},"click .remove":function(A,D,C,B){}};window.gameThemeEvent={"click .edit":function(A,D,C,B){openEditModal(C)},"click .remove":function(A,D,C,B){}};window.artTagEvent={"click .edit":function(A,D,C,B){openEditModal(C)},"click .remove":function(A,D,C,B){delNewGameTags(C)}};window.playTagEvent={"click .edit":function(A,D,C,B){openEditModal(C)},"click .remove":function(A,D,C,B){delNewGameTags(C)}};window.themeTagEvent={"click .edit":function(A,D,C,B){openEditModal(C)},"click .remove":function(A,D,C,B){delNewGameTags(C)}};window.newGameTypeEvent={"click .edit":function(A,D,C,B){openEditModal(C)},"click .remove":function(A,D,C,B){delNewGameType(C)}};$("#insertTag").click(function(){insertTag()});$("#updateTag").click(function(){updateTag()});$("#insertProblemType").click(function(){insertProblemType()});$("#updateProblemType").click(function(){updateProblemType()});$("#insertGameType").click(function(){insertGameType()});$("#updateGameType").click(function(){updateGameType()});$("#insertGameTag").click(function(){insertGameTag()});$("#updateGameTag").click(function(){updateGameTag()});$("#insertGameTheme").click(function(){insertGameTheme()});$("#updateGameTheme").click(function(){updateGameTheme()});$("#insertChildGameTag").click(function(){insertChildGameTag()});$("#updateNewGameTags").click(function(){updateNewGameTags()});$("#insertNewGameType").click(function(){insertChildNewGameTypes()});$("#updateNewGameTypes").click(function(){updateNewGameTypes()})}function openEditModal(A){if(A.value.length==8){$("#inputenumTypeID").val(A.enumTypeID);$("#inputenumID").val(A.value);$("#labelText").text(A.enumTypeName);$("#inputText").val(A.text);if(A.text.indexOf("<")>-1){$("#inputText").val(A.text.substr(0,A.text.indexOf("<")))}$("#createTagLabel").text("修改");$("#updateTag").show();$("#insertGameType").hide();$("#insertProblemType").hide();$("#updateProblemType").hide();$("#updateGameTag").hide();$("#updateGameTheme").hide();$("#insertTag").hide();$("#updateNewGameTags").hide();$("#updateNewGameTypes").hide()}else{if(getCurrentTabs()=="问题类型"){$("#inputenumID").val(A.value);$("#labelText").text("细分类型");$("#inputText").val($(A.text)[0].innerText);$("#createTagLabel").text("修改");$("#updateTag").hide();$("#insertGameType").hide();$("#insertProblemType").hide();$("#updateGameTag").hide();$("#updateGameTheme").hide();$("#updateProblemType").show();$("#insertTag").hide();$("#updateNewGameTags").hide();$("#updateNewGameTypes").hide()}else{if(getCurrentTabs()=="游戏标签"){$("#inputenumID").val(A.value);$("#labelText").text("游戏子标签");$("#inputText").val($(A.text)[0].innerText);$("#createTagLabel").text("修改");$("#updateTag").hide();$("#insertGameType").hide();$("#insertProblemType").hide();$("#updateProblemType").hide();$("#updateGameTag").show();$("#updateGameTheme").hide();$("#insertTag").hide();$("#updateNewGameTags").hide();$("#updateNewGameTypes").hide()}else{if(getCurrentTabs()=="游戏题材"){$("#inputenumID").val(A.value);$("#createTagLabel").text("修改");$("#updateTag").hide();$("#insertGameType").hide();$("#insertProblemType").hide();$("#updateProblemType").hide();$("#updateGameTag").hide();$("#insertTag").hide();$("#updateGameTheme").show();$("#inputText").val($(A.text)[0].innerText);$("#updateNewGameTags").hide();$("#updateNewGameTypes").hide();if($(A.text).length==2){$("#labelText").text("游戏二级题材")}else{$("#labelText").text("游戏三级题材")}}else{if(getCurrentTabs()=="美术及定位标签"||getCurrentTabs()=="玩法标签"||getCurrentTabs()=="题材标签"){$("#inputenumID").val(A.value);$("#labelText").text("游戏子标签");$("#inputText").val($(A.text)[0].innerText);$("#createTagLabel").text("修改");$("#updateTag").hide();$("#insertGameType").hide();$("#insertProblemType").hide();$("#updateProblemType").hide();$("#updateGameTag").hide();$("#updateGameTheme").hide();$("#insertTag").hide();$("#updateNewGameTags").show();$("#updateNewGameTypes").hide()}else{if(getCurrentTabs()=="游戏类型(新品)"){$("#inputenumID").val(A.value);$("#labelText").text("游戏类型");$("#inputText").val($(A.text)[0].innerText);$("#createTagLabel").text("修改");$("#updateTag").hide();$("#insertGameType").hide();$("#insertProblemType").hide();$("#updateProblemType").hide();$("#updateGameTag").hide();$("#updateGameTheme").hide();$("#insertTag").hide();$("#updateNewGameTags").hide();$("#updateNewGameTypes").show()}}}}}}$("#createTagModal").modal({backdrop:"static",keyboard:false})}function openGameTypeModal(A){$("#inputenumID").val(A.value);if(A.text.indexOf("<")==0){$("#inputGameType").val($(A.text)[0].innerText)}else{$("#inputGameType").val(A.text.substr(0,A.text.indexOf("<")))}$("#gameTypeModal").modal({backdrop:"static",keyboard:false})}function insertTag(){var D;for(var B=0;B<$("#siteTags > li").length;B++){if($($("#siteTags > li")[B]).hasClass("active")){D=$($("#siteTags > li")[B]).text()}}var A=$("#inputenumTypeID").val();var F=$("#inputText").val();if(A==0){if(getCurrentTabs()=="美术及定位标签"){insertNewGameTags()}else{if(getCurrentTabs()=="游戏类型(新品)"){insertNewGameTypes()}else{var E={"typeName":F,"parentTypeID":0};$.ajax({url:"addGameType.do",data:{"gameTypes":JSON.stringify(E)},method:"post",async:true,success:function(G){$.messager.popup("添加成功");$("#createTagModal").modal("hide");refreshTag()}})}}}else{if(A==1){insertNewGameTags()}else{if(A==2){insertNewGameTags()}else{var C={"enumTypeID":A,"enumTypeName":D,"text":F};$.ajax({url:"insertEnumValue.do",data:{"enumCRM":JSON.stringify(C)},method:"post",async:true,success:function(G){$.messager.popup("添加成功");$("#createTagModal").modal("hide");refreshTag()}})}}}}function updateTag(){var A=$("#inputenumTypeID").val();var C=$("#inputenumID").val();var D=$("#inputText").val();var B={"enumTypeID":A,"value":C,"text":D};$.ajax({url:"updateEnumValue.do",data:{"enumCRM":JSON.stringify(B)},method:"post",async:true,success:function(E){$.messager.popup("修改成功");$("#createTagModal").modal("hide");refreshTag()}})}function insertProblemType(){var C=$("#inputenumID").val();var A=$("#inputText").val();var B={"typeName":A,"category":C};$.ajax({url:"insertSubdivisionType.do",data:{"subdivisionType":JSON.stringify(B)},method:"post",async:true,success:function(D){$.messager.popup("添加成功");$("#createTagModal").modal("hide");refreshTag()}})}function updateProblemType(){var B=$("#inputenumID").val();var A=$("#inputText").val();var C={"typeName":A,"typeID":B};$.ajax({url:"updateSubdivisionType.do",data:{"subdivisionType":JSON.stringify(C)},method:"post",async:true,success:function(D){$.messager.popup("修改成功");$("#createTagModal").modal("hide");refreshTag()}})}function insertGameType(){var C=$("#inputText").val();var A=$("#inputenumID").val();var B={"typeName":C,"parentTypeID":A};$.ajax({url:"addGameType.do",data:{"gameTypes":JSON.stringify(B)},method:"post",async:true,success:function(D){$.messager.popup("添加成功");$("#createTagModal").modal("hide");refreshTag()}})}function updateGameType(){var B=$("#inputenumID").val();var A=$("#inputGameType").val();var C={"typeName":A,"typeID":B};$.ajax({url:"updateGameType.do",data:{"gameTypes":JSON.stringify(C)},method:"post",async:true,success:function(D){$.messager.popup("修改成功");$("#gameTypeModal").modal("hide");refreshTag()}})}function insertGameTag(){var A=$("#inputGameTag").val();var C=$("#inputenumID").val();var B={"tagName":A,"parentTag":C};$.ajax({url:"addGameTag.do",data:{"gameTag":JSON.stringify(B)},method:"post",async:true,success:function(D){$.messager.popup("添加成功");$("#gameTagModal").modal("hide");refreshTag()}})}function updateGameTag(){var C=$("#inputenumID").val();var A=$("#inputText").val();var B={"tagName":A,"tagID":C};$.ajax({url:"updateGameTag.do",data:{"gameTag":JSON.stringify(B)},method:"post",async:true,success:function(D){$.messager.popup("修改成功");$("#createTagModal").modal("hide");refreshTag()}})}function insertGameTheme(){var C=$("#inputenumID").val();var B=$("#inputGameTheme").val();var A={};if(C&&C.length==8){A={"themeName":B,"parentID":C,"parentID2":0}}else{A={"themeName":B,"parentID":"","parentID2":C}}$.ajax({url:"addGameTheme.do",data:{"gameTheme":JSON.stringify(A)},method:"post",async:true,success:function(D){$.messager.popup("添加成功");$("#gameThemeModal").modal("hide");refreshTag()}})}function updateGameTheme(){var B=$("#inputenumID").val();var C=$("#inputText").val();var A={"themeName":C,"themeID":B};$.ajax({url:"updateGameTheme.do",data:{"gameTheme":JSON.stringify(A)},method:"post",async:true,success:function(D){$.messager.popup("修改成功");$("#createTagModal").modal("hide");refreshTag()}})}function insertNewGameTags(){var A=$("#inputenumTypeID").val();var B=$("#inputText").val();var C={"tagID":A,"tagName":B,"parentTag":0};$.ajax({url:"insertNewGameTags.do",data:{"gameTag":JSON.stringify(C)},method:"post",async:true,success:function(D){$.messager.popup("添加成功");$("#createTagModal").modal("hide");refreshTag()}})}function insertChildGameTag(){var A;if(getCurrentTabs()=="美术及定位标签"){A=0}else{if(getCurrentTabs()=="玩法标签"){A=1}else{if(getCurrentTabs()=="题材标签"){A=2}}}var D=$("#inputenumID").val();var B=$("#inputChildGameTag").val();var C={"tagID":A,"tagName":B,"parentTag":D};$.ajax({url:"insertNewGameTags.do",data:{"gameTag":JSON.stringify(C)},method:"post",async:true,success:function(E){$.messager.popup("添加成功");$("#newGameTagModal").modal("hide");refreshTag()}})}function insertChildNewGameTypes(){var B=$("#inpuTypeID").val();var D=$("#inputenumID").val();var A=$("#inputNewGameType").val();var C={"typeID":B,"typeName":A,"parentTypeID":D};$.ajax({url:"insertNewGameTypes.do",data:{"gameTypes":JSON.stringify(C)},method:"post",async:true,success:function(E){$.messager.popup("添加成功");$("#newGameTypeModal").modal("hide");refreshTag()}})}function updateNewGameTags(){var C=$("#inputenumID").val();var A=$("#inputText").val();var B={"tagName":A,"tagID":C};$.ajax({url:"updateNewGameTags.do",data:{"gameTag":JSON.stringify(B)},method:"post",async:true,success:function(D){$.messager.popup("修改成功");$("#createTagModal").modal("hide");refreshTag()}})}function updateNewGameTypes(){var B=$("#inputenumID").val();var A=$("#inputText").val();var C={"typeName":A,"typeID":B};$.ajax({url:"updateNewGameTypes.do",data:{"gameTypes":JSON.stringify(C)},method:"post",async:true,success:function(D){$.messager.popup("修改成功");$("#createTagModal").modal("hide");refreshTag()}})}function insertNewGameTypes(){var A=$("#inputenumTypeID").val();var B=$("#inputText").val();var C={"typeID":A,"typeName":B,"parentTypeID":0};$.ajax({url:"insertNewGameTypes.do",data:{"gameTypes":JSON.stringify(C)},method:"post",async:true,success:function(D){$.messager.popup("添加成功");$("#createTagModal").modal("hide");refreshTag()}})}function addNewGameDetailType(A){$("#inputenumID").val(A);$("#inpuTypeID").val(1);$("#newGameTypeModal").modal({backdrop:"static",keyboard:false})}function addNewGameTzh(A){$("#inputenumID").val(A);$("#inpuTypeID").val(2);$("#newGameTypeModal").modal({backdrop:"static",keyboard:false})}function delEnumData(A){$.messager.confirm("","确定删除该条记录？",function(){var B={"enumTypeID":A.enumTypeID,"value":A.value};$.ajax({url:"delEnums.do",data:{"enumCRM":JSON.stringify(B)},method:"post",async:true,success:function(C){if(C.statusCode==504){$.messager.popup("系统错误，错误代码504。")}else{if(C.statusCode==4){window.open("login.jsp")}else{$.messager.popup("删除成功");refreshTag()}}}})})}function delNewGameTags(A){$.messager.confirm("","确定删除该条记录？",function(){var B=A.value;$.ajax({url:"delNewGameTags.do",data:{"Seqno":B},method:"post",async:true,success:function(C){if(C.statusCode==504){$.messager.popup("系统错误，错误代码504。")}else{if(C.statusCode==4){window.open("login.jsp")}else{$.messager.popup("删除成功");refreshTag()}}}})})}function delNewGameType(A){$.messager.confirm("","确定删除该条记录？",function(){var B=A.value;$.ajax({url:"delNewGameType.do",data:{"Seqno":JSON.stringify(B)},method:"post",async:true,success:function(C){if(C.statusCode==504){$.messager.popup("系统错误，错误代码504。")}else{if(C.statusCode==4){window.open("login.jsp")}else{$.messager.popup("删除成功");refreshTag()}}}})})}function refreshTag(){for(var A=0;A<$("#siteTags > li").length;A++){if($($("#siteTags > li")[A]).hasClass("active")){$($($($("#siteTags > li")[A]).find("a")[0].hash).find("table")[1]).bootstrapTable("refresh")}}}function addType(A){$("#inputText").val("");if(A&&A.length==8){$("#insertGameType").hide();$("#insertProblemType").show();$("#updateProblemType").hide();$("#insertTag").hide();$("#updateTag").hide();$("#updateGameTag").hide();$("#updateGameTheme").hide();$("#updateNewGameTags").hide();$("#updateNewGameTypes").hide();$("#inputenumID").val(A);$("#createTagLabel").text("添加细分类型");$("#labelText").text("细分类型")}else{$("#insertGameType").show();$("#insertProblemType").hide();$("#updateProblemType").hide();$("#insertTag").hide();$("#updateTag").hide();$("#updateGameTag").hide();$("#updateGameTheme").hide();$("#updateNewGameTags").hide();$("#updateNewGameTypes").hide();$("#inputenumID").val(A);$("#createTagLabel").text("添加游戏类型");$("#labelText").text("游戏子类型")}$("#createTagModal").modal({backdrop:"static",keyboard:false})}function addTag(A){$("#inputenumID").val(A);$("#gameTagModal").modal({backdrop:"static",keyboard:false})}function addTheme(A){$("#inputenumID").val(A);if(A&&A.length==8){$("#labelTheme").text("游戏二级题材")}else{$("#labelTheme").text("游戏三级题材")}$("#gameThemeModal").modal({backdrop:"static",keyboard:false})}function addNewGameTag(A){$("#inputenumID").val(A);$("#newGameTagModal").modal({backdrop:"static",keyboard:false})}function getCurrentTabs(){for(var A=0;A<$("#siteTags > li").length;A++){if($($("#siteTags > li")[A]).hasClass("active")){return enumTypeName=$($("#siteTags > li")[A]).text()}}};