var monthPicker={_conf:{startYear:1970,endYear:new Date().getFullYear(),cols:4,rows:3,container:"gri_monthPicker_wrapper",calendar:"gri_monthPicker_panel",dataTable:"gri_monthPicker_table",containerCss:"calendar cf",selectCss:"current",contentCss:"calendar_cont cf",tableCss:"calendar-month",disabledCss:"dis",input:{},id:"month_picker",trigger:"month_trigger",callback:function(A){return true},autoCommit:false,returnMonth:false,defaultMonth:"",lastMonth:false,period:false,start_month:"",end_month:"",all_month_valid:false,defaultText:" 至 "},assemble:{"year":new Date().getFullYear(),"month":new Date().getMonth()+1},create:function(D,B){var A=this;A._conf.id=D;A._conf=$.extend(true,A._conf,B);$("#"+D).length>0&&function(){$("#"+D).bind("click",function(){A.show(A.util.$(D))})}();$("#"+A._conf.trigger).length>0&&function(){$("#"+A._conf.trigger).bind("click",function(){A.show(A.util.$(D))})}();if(A._conf.period&&A._conf.start_month!=""&&A._conf.end_month!=""){$("#"+D).html(A._conf.start_month+A._conf.defaultText+A._conf.end_month);A._conf.autoCommit&&A._conf.callback({startDate:A._conf.start_month+"-01",endDate:A._conf.end_month+"-31"})}else{this._conf.lastMonth&&(this.assemble.month=new Date().getMonth());""!==this._conf.defaultMonth&&(this.assemble={"year":this._conf.defaultMonth.substr(0,4),"month":this._conf.defaultMonth.substr(4)*1});var C=this.util.format(this.assemble);$("#"+D).html(C.year+"-"+C.month);A._conf.autoCommit&&A._conf.callback(A.convertToDate(this.util.format(this.assemble)))}$(document).bind("click",function(E){A.cancel(E)})},getCurrentShowDate:function(){var A=this,B="";if($("#"+A._conf.id).length>0){B=$("#"+A._conf.id).html();return{"year":B.split("-")[0],"month":B.split("-")[1]}}},convertToDate:function(A){if(this._conf.returnMonth){return{"start_date":A.year+"-"+A.month+"-01","end_date":A.year+"-"+A.month+"-31"}}else{return A.year+"-"+A.month}},show:function(C){this._conf.input=C;if(this.util.$(this._conf.container)){var D=$("#"+this._conf.id).offset();var E=$("#"+this._conf.id).attr("offsetHeight");this.util.$(this._conf.container).style.display="block";this.util.$(this._conf.container).style.top=D.top+(E?E-1:32)+"px";this.util.$(this._conf.container).style.left=D.left+"px";return false}var F=this.util.creatEle("div");F.setAttribute("id",this._conf.container);$(F).addClass(this._conf.containerCss);F.style.zIndex="9999";var D=$("#"+this._conf.id).offset();var E=$("#"+this._conf.id).attr("offsetHeight");F.style.top=D.top+(E?E-1:32)+"px";F.style.left=D.left+"px";document.body.appendChild(F);var B=this.util.creatEle("div");B.id=this._conf.calendar;$(B).addClass(this._conf.contentCss);var A=[];A.push('<i class="i_pre" style="z-index:1" id="gri_preYear"></i>');A.push('<i class="i_next" style="z-index:1" id="gri_nextYear"></i>');$(B).append(A.join(""));F.appendChild(B);F.style.display="block";this.init()},init:function(){var E=this;var C=panel=[];var H=this.util.creatEle("table");$(H).addClass(this._conf.tableCss);var A=document.createElement("caption");var B=document.createElement("span");B.id="gri_year";$(B).append(this._conf.endYear+"年");$(A).append(B);$(H).append(A);var G=this.util.creatEle("tbody");var F=this.util.creatEle("tr");var D=this.util.creatEle("td");G.setAttribute("id",this._conf.dataTable);H.appendChild(G);this._conf.calendar?this.util.$(this._conf.calendar).appendChild(H):document.body.appendChild(H);this.construct();C=[];$("#gri_preYear").click(function(){E.preYear(E.reset)});$("#gri_nextYear").click(function(){E.nextYear(E.reset)});this.reset(this);return H},construct:function(){that=this;$("#"+this._conf.dataTable).html("");var F={data:{1:[1,2,3,4],2:[5,6,7,8],3:[9,10,11,12]},typical:{1:"一",2:"二",3:"三",4:"四",5:"五",6:"六",7:"七",8:"八",9:"九",10:"十",11:"十一",12:"十二"},special:{}};for(var B in F.data){var C=this.util.creatEle("tr");for(var A=0;A<F.data[B].length;A++){var D=this.util.creatEle("td");D.innerHTML=F.typical[F.data[B][A]]+"月";D.setAttribute("id","gri_month"+F.data[B][A]);var E=this.addCss;if(!this._conf.all_month_valid&&this.assemble.year==this.util.getCurrentDate().year&&F.data[B][A]>this.util.getCurrentDate().month){$(D).addClass(this._conf.disabledCss)}else{if(this._conf.period){E=this.hdlPeriod}if(window.attachEvent){D.attachEvent("onclick",E)}else{D.addEventListener("click",E,false)}}C.appendChild(D)}$("#"+this._conf.dataTable).append(C)}},preYear:function(A){--this.assemble.year;this.util.$("gri_year").innerHTML=this.assemble.year+"年";A&&A(this)},nextYear:function(A){++this.assemble.year;this.util.$("gri_year").innerHTML=this.assemble.year+"年";A&&A(this)},hdlPeriod:function(B){var B=window.event||B,E=B.srcElement||B.target;var A=(/^gri_month(\d+)/).test(E.getAttribute("id"))&&(/^gri_month(\d+)/).exec(E.getAttribute("id"))[1];var F=D={};that.removeCss();(monthPicker.Params.current==""||monthPicker.Params.current==monthPicker.Constant.END_MONTH)?(monthPicker.Params.current=monthPicker.Constant.START_MONTH):(monthPicker.Params.current=monthPicker.Constant.END_MONTH);if(monthPicker.Params.current==monthPicker.Constant.START_MONTH){$(E).addClass(that._conf.selectCss);monthPicker.Params.start_month=A;monthPicker.Params.start_year=that.assemble.year}else{monthPicker.Params.end_month=A;monthPicker.Params.end_year=that.assemble.year;var C=that.periodCss();var F=C.start,D=C.end;that._conf.input.innerHTML=[F.year,F.month].join("-")+that._conf.defaultText+[D.year,D.month].join("-");that._conf.callback({startDate:F.year+"-"+F.month,endDate:D.year+"-"+D.month});that.util.$(that._conf.container).style.display="none"}},addCss:function(A){that.removeCss();var A=window.event||A,B=A.srcElement||A.target;$(B).addClass(that._conf.selectCss);that.assemble.month=(/^gri_month(\d+)/).test(B.getAttribute("id"))&&(/^gri_month(\d+)/).exec(B.getAttribute("id"))[1];that.submit()},removeCss:function(){var B=/^gri_month(\d+)/;var C=$("#gri_monthPicker_table").find("td");for(var A in C){if(C[A].id&&B.test(C[A].id)){$(C[A]).removeClass(this._conf.selectCss).removeClass(this._conf.disabledCss);if(!this._conf.all_month_valid&&this.assemble.year==this.util.getCurrentDate().year&&C[A].id.match(B)[1]>this.util.getCurrentDate().month){$(C[A]).addClass(this._conf.disabledCss)}}}},periodCss:function(){var D=that.util.format({year:monthPicker.Params.start_year,month:monthPicker.Params.start_month});var C=that.util.format({year:monthPicker.Params.end_year,month:monthPicker.Params.end_month});if(new Date([D.year,D.month,"01"].join("-")).getTime()>new Date([C.year,C.month,"01"].join("-")).getTime()){var A=D;D=C;C=A}if(monthPicker.Params.start_year==monthPicker.Params.end_year){if(that.assemble.year==D.year||""==D.year){sm=Math.min(monthPicker.Params.end_month,monthPicker.Params.start_month);em=Math.max(monthPicker.Params.end_month,monthPicker.Params.start_month);for(var B=sm;B<=em;B++){$("#gri_month"+B).addClass(that._conf.selectCss)}}else{that.removeCss()}}else{if(that.assemble.year==D.year){for(var B=D.month*1;B<=12;B++){$("#gri_month"+B).addClass(that._conf.selectCss)}}else{if(that.assemble.year==C.year){for(var B=1;B<=C.month*1;B++){$("#gri_month"+B).addClass(that._conf.selectCss)}}else{that.removeCss()}}}return{"start":D,"end":C}},cancel:function(A){var A=window.event||A,B=A.srcElement||A.target;!(B.id&&(B.id==this._conf.id||B.id==this._conf.trigger)||(this._conf.period&&monthPicker.Params.current==monthPicker.Constant.START_MONTH)||B.className&&(B.className=="i_pre"||B.className=="i_next"))&&$("#"+this._conf.container).length>0&&$("#"+this._conf.container).hide()},submit:function(){var A=[];fd=this.util.format(this.assemble);for(var B in fd){A.push(fd[B])}this.util.$(this._conf.container).style.display="none";this._conf.input.innerHTML=A.join("-");this._conf.callback(this.convertToDate(this.util.format(this.assemble)))},reset:function(A){A.construct();A.util.$("gri_nextYear").style.display=(A.assemble.year>=A._conf.endYear)?"none":"block";A.util.$("gri_preYear").style.display=(A.assemble.year<=A._conf.startYear)?"none":"block";var B=A.getCurrentShowDate();if(A.util.format(A.assemble).year==B.year&&A.util.format(A.assemble).month==B.month){$("#gri_month"+A.assemble.month).addClass(A._conf.selectCss)}if(A._conf.period){A.periodCss()}},util:{$:function(A){return document.getElementById(A)},creatEle:function(A){return document.createElement(A)},addEvt:function(C,A,B){var D=function(E){var E=window.event||E,F=E.srcElement||E.target;B(E,F)};window.addEventListener&&C.addEventListener(A,D,false)||window.attachEvent&&C.attachEvent("on"+A,D)},getCurrentDate:function(){return{"year":new Date().getFullYear(),"month":new Date().getMonth()+1}},getCla:function(){return !!(window.attachEvent&&navigator.userAgent.indexOf("Opera")===-1)?"class":"class"},format:function(A){return{"year":A.year,"month":(A.month<10?"0":"")+A.month}}}};monthPicker.Constant={START_MONTH:"start_month",END_MONTH:"end_month"};monthPicker.Params={current:"",start_year:"",start_month:"",end_month:"",end_year:""};